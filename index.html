<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
        <link rel="stylesheet" href="style.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>
        <script src="utils.js"></script>
        <script src="dom.js"></script>
        <script src="data.js"></script>
        <title>Shen Open Source Language</title>
        <script>
            function linkIcon(url) {
                if (url.contains("github.com")) {
                    return "fab fa-github";
                }
                const lastSlash = url.lastIndexOf("/");
                if (url.substring(lastSlash + 1).contains(".")) {
                    return "fas fa-download";
                }
                return "fas fa-link";
            }

            function projectName(p) {
                if (p.name) {
                    return p.name;
                }
                const lastSlash = p.url.lastIndexOf("/");
                return p.url.substring(lastSlash + 1);
            }

            function subsectionRow(title) {
                return h("tr", h("th", { colspan: 3 }, title));
            }

            function kernelVersionStyle(kernel) {
                if (parseFloat(kernel) === latestKernelVersion) {
                    return "latest";
                } else if (parseFloat(kernel) >= recentKernelVersion) {
                    return "recent";
                } else {
                    return "outdated";
                }
            }

            function kernelVersionNote(kernel) {
                switch (kernelVersionStyle(kernel)) {
                    case "latest": return "Up-to-date with the latest";
                    case "recent": return "Compatible with recent versions";
                    case "outdated": return "Several versions out-of-date";
                }
            }

            function portRow(port) {
                return h("tr",
                    h("td", port.platform),
                    h("td",
                        h("i", { class: linkIcon(port.url) }),
                        " ",
                        h("a", { href: port.url }, projectName(port))),
                    h("td", { class: kernelVersionStyle(port.kernel), title: kernelVersionNote(port.kernel) }, port.kernel));
            }

            function portGroup(ports, title, predicate) {
                return [
                    subsectionRow(title),
                    ports.filter(predicate).sortBy(p => p.platform).map(portRow)
                ];
            }

            function setup() {
                const listedPorts = ports.filter(p => !p.archival);
                const table =
                    h("table",
                        h("thead",
                            h("tr",
                                h("th", "Platform"),
                                h("th", "Port"),
                                h("th", "Kernel"))),
                        h("tbody",
                            portGroup(listedPorts, "Certified", p => p.certified),
                            portGroup(listedPorts, "Uncertified", p => !p.certified)));
                var target = document.getElementById("downloads-table");
                target.parentNode.replaceChild(table, target);
            }

            setTimeout(setup, 0);
        </script>
    </head>
    <body>
        <main>
            <div>
                <img src="https://cdn.rawgit.com/Shen-Language/shen-sources/master/assets/shen.svg">
            </div>
            <header>Downloads</header>
            <p>
                Below are various implementations of Shen for most platforms. Some have fallen out of date and could use support to reach Certified status and stay current.
            </p>
            <p>
                An implementation is considered Certified if it passes the test suite included with the <a href="https://github.com/Shen-Language/shen-sources">kernel sources</a>.
            </p>
            <p>
                To port Shen to a new platform, <a href="https://github.com/Shen-Language/shen-sources/blob/master/doc/porting.md">see the porting guide</a> on implementing Shen. You can <a href="https://github.com/Shen-Language/shen-language.github.io/">submit a pull request</a> to get it added here.
            </p>
            <div id="downloads-table"></div>
        </main>
    </body>
</html>
