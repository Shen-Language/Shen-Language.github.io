<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
        <link rel="stylesheet" href="style.css">
        <link ref="icon" type="image/png" href="favicon.png">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>
        <script src="utils.js"></script>
        <script src="dom.js"></script>
        <script src="data.js"></script>
        <title>Shen Open Source Language</title>
        <script>
            function linkIcon(url) {
                if (url.contains("mailto:")) {
                    return "far fa-envelope";
                }
                if (url.contains("github.com")) {
                    return "fab fa-github";
                }
                const lastSlash = url.lastIndexOf("/");
                if (url.substring(lastSlash + 1).contains(".")) {
                    return "fas fa-download";
                }
                return "fas fa-link";
            }

            function link(url, name) {
                return h("span",
                    { class: "link-spacer" },
                    h("i", { class: linkIcon(url) }),
                    " ",
                    h("a", { href: url }, name));
            }

            function projectName(p) {
                if (p.name) {
                    return p.name;
                }
                const lastSlash = p.url.lastIndexOf("/");
                return p.url.substring(lastSlash + 1);
            }

            function subsectionRow(title) {
                return h("tr", h("th", { colspan: 3 }, title));
            }

            function kernelVersionStyle(kernel) {
                if (parseFloat(kernel) === latestKernelVersion) {
                    return "latest";
                } else if (parseFloat(kernel) >= recentKernelVersion) {
                    return "recent";
                } else {
                    return "outdated";
                }
            }

            function kernelVersionNote(kernel) {
                switch (kernelVersionStyle(kernel)) {
                    case "latest": return "Up-to-date with the latest";
                    case "recent": return "Compatible with recent versions";
                    case "outdated": return "Several versions out-of-date";
                }
            }

            function portRow(port) {
                return h("tr",
                    h("td", port.platform),
                    h("td", link(port.url, projectName(port))),
                    h("td", { class: kernelVersionStyle(port.kernel), title: kernelVersionNote(port.kernel) }, port.kernel));
            }

            function portGroup(ports, title, predicate) {
                return [
                    subsectionRow(title),
                    ports.filter(predicate).sortBy(p => p.platform).map(portRow)
                ];
            }

            function setupDownloadsTable() {
                const listedPorts = ports.filter(p => !p.archival);
                const table =
                    h("table",
                        h("thead",
                            h("tr",
                                h("th", "Platform"),
                                h("th", "Port"),
                                h("th", "Kernel"))),
                        h("tbody",
                            portGroup(listedPorts, "Certified", p => p.certified),
                            portGroup(listedPorts, "Uncertified", p => !p.certified)));
                const target = document.getElementById("downloads-table");
                target.parentNode.replaceChild(table, target);
            }

            function fetchContributors(f) {
                const cached = localStorage.getItem("contributors");
                if (cached) {
                    console.log("Using cached contributors");
                    f(JSON.parse(cached));
                } else {
                    console.log("Fetching contributors");
                    const repos = [
                        "Shen-Language/shen-cl",
                        "Shen-Language/shen-sources",
                        "Shen-Language/shen-language.github.io"
                    ];
                    const rootApiUrl = "https://api.github.com";
                    const contribApiUrl = repo => rootApiUrl + "/repos/" + repo + "/stats/contributors";
                    const profileApiUrl = login => rootApiUrl + "/users/" + login;
                    const fetchJson = url => fetch(url).then(r => r.json());
                    Promise.all(
                        repos.map(contribApiUrl).map(u =>
                            fetchJson(u).then(cs =>
                                cs.map(c => c.author.login)))
                    ).then(ls => {
                        const logins = _.uniq(_.flatten(ls));
                        Promise.all(
                            logins.map(profileApiUrl).map(u =>
                                fetchJson(u).then(c => ({
                                    github: c.login,
                                    name: c.name,
                                    blog: c.blog
                                })))
                        ).then(us => {
                            localStorage.setItem("contributors", JSON.stringify(us));
                            f(us);
                        });
                    });
                }
            }

            function setupCommunityTable() {
                fetchContributors(contributors => {
                    const table =
                        h("table",
                            h("thead",
                                h("tr",
                                    h("th", "Contributor"),
                                    h("th", "Links"))),
                            h("tbody", contributors.sortBy(p => (p.name || p.github || "").toLowerCase()).map(p =>
                                h("tr",
                                    h("td", p.name || p.github),
                                    h("td", [
                                        p.github && link("https://github.com/" + p.github, p.github),
                                        p.blog && link(p.blog, "blog")
                                    ])))));
                    const target = document.getElementById("community-table");
                    target.parentNode.replaceChild(table, target);
                });
            }

            function setup() {
                setupDownloadsTable();
                setupCommunityTable();
            }

            setTimeout(setup, 0);
        </script>
    </head>
    <body>
        <main>
            <section>
                <img id="logo" src="https://cdn.rawgit.com/Shen-Language/shen-sources/master/assets/shen.svg">
            </section>
            <section>
                <header>About</header>
                <p>
                    Shen is a portable functional programming language by <a href="http://www.marktarver.com/">Mark Tarver</a> offering:
                </p>
                <ul class="feature-list">
                    <!-- Make these links to docs or tutorial pages about the respective feature -->
                    <li class="feature-item">Pattern Matching</li>
                    <li class="feature-item">Lambda Calculus Consistency</li>
                    <li class="feature-item">Unique Macros</li>
                    <li class="feature-item">Optional Lazy Evalution</li>
                    <li class="feature-item">Configurable Static Type System</li>
                    <li class="feature-item">Integrated Logic Engine</li>
                    <li class="feature-item">Built-in Compiler-Compiler</li>
                    <li class="feature-item">Interactive Debugger</li>
                </ul>
                <p>
                    More information is available on the <a href="http://shenlanguage.org">official website</a> and in <a href="https://www.amazon.co.uk/Book-Shen-Third-Mark-Tarver/dp/1784562130/ref=sr_1_2?s=books&ie=UTF8&qid=1459204767&sr=1-2">The Book of Shen</a>.
                </p>
            </section>
            <section>
                <header>Demo</header>
                <p>
                    An in-browser REPL is hosted <a href="http://gravicappa.github.io/shen-js/shen.html#/.doc/welcome.html">here</a> where you can try out Shen and take a brief tutorial.
                </p>
            </section>
            <section>
                <header>Downloads</header>
                <p>
                    There are implementations of Shen for most platforms. Some have fallen out of date and could use support to reach Certified status and stay current.
                </p>
                <p>
                    An implementation is considered Certified if it passes <a href="https://github.com/Shen-Language/shen-sources/tree/master/tests">the test suite</a> included with the <a href="https://github.com/Shen-Language/shen-sources/tree/master/sources">kernel sources</a>.
                </p>
                <p>
                    To port Shen to a new platform, <a href="https://github.com/Shen-Language/shen-sources/blob/master/doc/porting.md">see the porting guide</a>. You can <a href="https://github.com/Shen-Language/shen-language.github.io/pull/new/master">submit a pull request</a> to get it added here.
                </p>
                <div class="table-spacer">
                    <div id="downloads-table"></div>
                </div>
            </section>
            <section>
                <header>Contributing</header>
                <p>
                    The Shen Open Source Kernel is authored in Shen itself and hosted <a href="https://github.com/Shen-Language/shen-sources">on GitHub</a>. Bug reports and suggested enhancements are welcome!
                </p>
            </section>
            <section>
                <header>Community</header>
                <p>
                    The follow is a (non-exhaustive) list of developers who have contributed to the Shen Language Open Source Community.
                </p>
                <div class="table-spacer">
                    <div id="community-table"></div>
                </div>
                <p>
                    Thanks to everyone for contributing!
                </p>
            </section>
        </main>
    </body>
</html>
